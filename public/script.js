(function(){var e,t,n,o,r,i,s,_,c,u,l,h,f,a,p,y,d,m,k,v={}.hasOwnProperty,g=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};i={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1,normalize_caps_lock:!1},m="meta alt option ctrl shift cmd".split(" "),y="ctrl",e={debug:!1};var b=function(e){var t,n;for(t in e)v.call(e,t)&&(!1!==(n=e[t])&&(this[t]=n));this.keys=this.keys||[],this.count=this.count||0};b.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},b.prototype.reset=function(){return this.count=0,this.keyup_fired=null};var w=function(e,t){var n,o;for(n in"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(1!==e.length&&p("Warning: your jQuery selector should have exactly one object."),e=e[0]),this.should_force_event_defaults=this.should_suppress_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=t||{},i)v.call(i,n)&&(o=i[n],this._defaults[n]=this._defaults[n]||o);this.element=e||document.body,n=function(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n),n};var r=this;this.keydown_event=n(this.element,"keydown",function(e){return e=e||window.event,r._receive_input(e,!0),r._bug_catcher(e)});var s=this;this.keyup_event=n(this.element,"keyup",function(e){return e=e||window.event,s._receive_input(e,!1)});var _=this;this.blur_event=n(window,"blur",function(){var e,t,n,o;for(t=0,n=(o=_._keys_down).length;t<n;t++)e=o[t],_._key_up(e,{});return _._keys_down=[]})};w.prototype.destroy=function(){var e;return(e=function(e,t,n){return null!=e.removeEventListener?e.removeEventListener(t,n):null!=e.removeEvent?e.removeEvent("on"+t,n):void 0})(this.element,"keydown",this.keydown_event),e(this.element,"keyup",this.keyup_event),e(window,"blur",this.blur_event)},w.prototype._bug_catcher=function(e){var t,n;if("cmd"===y&&0<=g.call(this._keys_down,"cmd")&&"cmd"!==(t=o(null!=(n=e.keyCode)?n:e.key))&&"shift"!==t&&"alt"!==t&&"caps"!==t&&"tab"!==t)return this._receive_input(e,!1)},w.prototype._cmd_bug_check=function(e){return!("cmd"===y&&0<=g.call(this._keys_down,"cmd")&&0>g.call(e,"cmd"))},w.prototype._prevent_default=function(e,t){if((t||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation))return e.stopPropagation()},w.prototype._get_active_combos=function(e){var t,n;return t=[],(n=s(this._keys_down,function(t){return t!==e})).push(e),this._match_combo_arrays(n,function(e){return function(n){if(e._cmd_bug_check(n.keys))return t.push(n)}}(this)),this._fuzzy_match_combo_arrays(n,function(e){return function(n){if(!(0<=g.call(t,n))&&!n.is_solitary&&e._cmd_bug_check(n.keys))return t.push(n)}}(this)),t},w.prototype._get_potential_combos=function(e){var t,n,o,r,i;for(n=[],o=0,r=(i=this._registered_combos).length;o<r;o++)(t=i[o]).is_sequence||0<=g.call(t.keys,e)&&this._cmd_bug_check(t.keys)&&n.push(t);return n},w.prototype._add_to_active_combos=function(e){var t,n,o,r,i,s,_,c,u,l,h;if(s=!1,i=!0,o=!1,0<=g.call(this._active_combos,e))return!0;if(this._active_combos.length)for(r=_=0,l=this._active_combos.length;0<=l?_<l:_>l;r=0<=l?++_:--_)if((t=this._active_combos[r])&&t.is_exclusive&&e.is_exclusive){if(t=t.keys,!s)for(c=0,u=t.length;c<u;c++)if(n=t[c],s=!0,0>g.call(e.keys,n)){s=!1;break}if(i&&!s)for(c=0,u=(h=e.keys).length;c<u;c++)if(n=h[c],i=!1,0>g.call(t,n)){i=!0;break}s&&(o?null!=(t=this._active_combos.splice(r,1)[0])&&t.reset():(null!=(t=this._active_combos.splice(r,1,e)[0])&&t.reset(),o=!0),i=!1)}return i&&this._active_combos.unshift(e),s||i},w.prototype._remove_from_active_combos=function(e){var t,n,o;for(t=n=0,o=this._active_combos.length;0<=o?n<o:n>o;t=0<=o?++n:--n)if(this._active_combos[t]===e){(e=this._active_combos.splice(t,1)[0]).reset();break}},w.prototype._get_possible_sequences=function(){var e,t,n,o,r,i,_,c,u,l,h,f;for(o=[],i=0,u=(l=this._registered_combos).length;i<u;i++)for(e=l[i],t=_=1,h=this._sequence.length;1<=h?_<=h:_>=h;t=1<=h?++_:--_)if(r=this._sequence.slice(-t),e.is_sequence){if(0>g.call(e.keys,"shift")&&!(r=s(r,function(e){return"shift"!==e})).length)continue;for(t=c=0,f=r.length;0<=f?c<f:c>f;t=0<=f?++c:--c){if(e.keys[t]!==r[t]){n=!1;break}n=!0}n&&o.push(e)}return o},w.prototype._add_key_to_sequence=function(e,t){var n,o,r,i;if(this._sequence.push(e),(o=this._get_possible_sequences()).length){for(r=0,i=o.length;r<i;r++)n=o[r],this._prevent_default(t,n.prevent_default);if(this._sequence_timer&&clearTimeout(this._sequence_timer),-1<this.sequence_delay){var s=this;this._sequence_timer=setTimeout(function(){return s._sequence=[]},this.sequence_delay)}}else this._sequence=[]},w.prototype._get_sequence=function(e){var t,n,o,r,i,_,c,u,l,h,f,a;for(_=0,l=(h=this._registered_combos).length;_<l;_++)if((t=h[_]).is_sequence){for(n=c=1,f=this._sequence.length;1<=f?c<=f:c>=f;n=1<=f?++c:--c)if(i=s(this._sequence,function(e){return 0<=g.call(t.keys,"shift")||"shift"!==e}).slice(-n),t.keys.length===i.length)for(n=u=0,a=i.length;0<=a?u<a:u>a;n=0<=a?++u:--u)if(r=i[n],!(0>g.call(t.keys,"shift")&&"shift"===r||"shift"===e&&0>g.call(t.keys,"shift"))){if(t.keys[n]!==r){o=!1;break}o=!0}if(o)return t.is_exclusive&&(this._sequence=[]),t}return!1},w.prototype._receive_input=function(e,t){var n,r;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(n=o(null!=(r=e.keyCode)?r:e.key),(t||this._keys_down.length||"alt"!==n&&n!==y)&&n)return t?this._key_down(n,e):this._key_up(n,e)},w.prototype._fire=function(e,t,n,o){if("function"==typeof t["on_"+e]&&this._prevent_default(n,!0!==t["on_"+e].call(t.this,n,t.count,o)),"release"===e&&(t.count=0),"keyup"===e)return t.keyup_fired=!0},w.prototype._match_combo_arrays=function(e,o){var r,i,s,_,c;for(s=0,_=(c=this._registered_combos).length;s<_;s++)i=c[s],r=e.slice(0),i.normalize_caps_lock&&0<=g.call(r,"caps")&&r.splice(r.indexOf("caps"),1),(!i.is_unordered&&n(r,i.keys)||i.is_unordered&&t(r,i.keys))&&o(i)},w.prototype._fuzzy_match_combo_arrays=function(e,t){var n,o,r,i;for(o=0,r=(i=this._registered_combos).length;o<r;o++)(!(n=i[o]).is_unordered&&u(n.keys,e)||n.is_unordered&&c(n.keys,e))&&t(n)},w.prototype._keys_remain=function(e){var t,n,o,r;for(n=0,o=(r=e.keys).length;n<o;n++)if(e=r[n],0<=g.call(this._keys_down,e)){t=!0;break}return t},w.prototype._key_down=function(e,t){var n,o,i,s,_;for(i in(n=r(e,t))&&(e=n),this._add_key_to_sequence(e,t),(n=this._get_sequence(e))&&this._fire("keydown",n,t),d)t[n=d[i]]&&(i===e||0<=g.call(this._keys_down,i)||this._keys_down.push(i));for(i in d)if(n=d[i],i!==e&&0<=g.call(this._keys_down,i)&&!t[n]&&("cmd"!==i||"cmd"===y))for(n=o=0,s=this._keys_down.length;0<=s?o<s:o>s;n=0<=s?++o:--o)this._keys_down[n]===i&&this._keys_down.splice(n,1);for(o=this._get_active_combos(e),i=this._get_potential_combos(e),s=0,_=o.length;s<_;s++)n=o[s],this._handle_combo_down(n,i,e,t);if(i.length)for(o=0,s=i.length;o<s;o++)n=i[o],this._prevent_default(t,n.prevent_default);0>g.call(this._keys_down,e)&&this._keys_down.push(e)},w.prototype._handle_combo_down=function(e,t,n,o){var r,i,s,_,c;if(0>g.call(e.keys,n))return!1;if(this._prevent_default(o,e&&e.prevent_default),r=!1,0<=g.call(this._keys_down,n)&&(r=!0,!e.allows_key_repeat()))return!1;if(s=this._add_to_active_combos(e,n),n=e.keyup_fired=!1,e.is_exclusive)for(_=0,c=t.length;_<c;_++)if((i=t[_]).is_exclusive&&i.keys.length>e.keys.length){n=!0;break}return!n&&(e.is_counting&&"function"==typeof e.on_keydown&&(e.count+=1),s)?this._fire("keydown",e,o,r):void 0},w.prototype._key_up=function(e,t){var n,o,i,s,_,c;if(n=e,(i=r(e,t))&&(e=i),i=a[n],t.shiftKey?i&&0<=g.call(this._keys_down,i)||(e=n):n&&0<=g.call(this._keys_down,n)||(e=i),(s=this._get_sequence(e))&&this._fire("keyup",s,t),0>g.call(this._keys_down,e))return!1;for(s=_=0,c=this._keys_down.length;0<=c?_<c:_>c;s=0<=c?++_:--_)if((o=this._keys_down[s])===e||o===i||o===n){this._keys_down.splice(s,1);break}for(o=this._active_combos.length,i=[],s=0,_=(c=this._active_combos).length;s<_;s++)n=c[s],0<=g.call(n.keys,e)&&i.push(n);for(s=0,_=i.length;s<_;s++)n=i[s],this._handle_combo_up(n,t,e);if(1<o)for(o=0,s=(_=this._active_combos).length;o<s;o++)void 0===(n=_[o])||0<=g.call(i,n)||this._keys_remain(n)||this._remove_from_active_combos(n)},w.prototype._handle_combo_up=function(e,n,o){var r,i;this._prevent_default(n,e&&e.prevent_default),i=this._keys_remain(e),e.keyup_fired||((r=this._keys_down.slice()).push(o),e.is_solitary&&!t(r,e.keys))||(this._fire("keyup",e,n),e.is_counting&&"function"==typeof e.on_keyup&&"function"!=typeof e.on_keydown&&(e.count+=1)),i||(this._fire("release",e,n),this._remove_from_active_combos(e))},w.prototype.simple_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t})},w.prototype.counting_combo=function(e,t){return this.register_combo({keys:e,is_counting:!0,is_unordered:!1,on_keydown:t})},w.prototype.sequence_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t,is_sequence:!0,is_exclusive:!0})},w.prototype.register_combo=function(e){var t,n,o;for(t in"string"==typeof e.keys&&(e.keys=e.keys.split(" ")),o=this._defaults)v.call(o,t)&&(n=o[t],void 0===e[t]&&(e[t]=n));if(e=new b(e),k(e))return this._registered_combos.push(e),e},w.prototype.register_many=function(e){var t,n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push(this.register_combo(t));return r},w.prototype.unregister_combo=function(e){var o,r,i,s,_,c;if(!e)return!1;var u=this;if(r=function(e){var t,n,o,r;for(r=[],t=n=0,o=u._registered_combos.length;0<=o?n<o:n>o;t=0<=o?++n:--n){if(e===u._registered_combos[t]){u._registered_combos.splice(t,1);break}r.push(void 0)}return r},e instanceof b)return r(e);if("string"==typeof e)for(o=i=0,s=(e=e.split(" ")).length;0<=s?i<s:i>s;o=0<=s?++i:--i)"meta"===e[o]&&(e[o]=y);for(c=[],i=0,s=(_=this._registered_combos).length;i<s;i++)null!=(o=_[i])&&(o.is_unordered&&t(e,o.keys)||!o.is_unordered&&n(e,o.keys)?c.push(r(o)):c.push(void 0));return c},w.prototype.unregister_many=function(e){var t,n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push(this.unregister_combo(t));return r},w.prototype.get_registered_combos=function(){return this._registered_combos},w.prototype.reset=function(){return this._registered_combos=[]},w.prototype.listen=function(){return this._prevent_capture=!1},w.prototype.stop_listening=function(){return this._prevent_capture=!0},w.prototype.get_meta_key=function(){return y},e.Listener=w,o=function(e){return f[e]},s=function(e,t){var n,o,r,i;if(e.filter)return e.filter(t);for(i=[],o=0,r=e.length;o<r;o++)t(n=e[o])&&i.push(n);return i},t=function(e,t){var n,o,r;if(e.length!==t.length)return!1;for(o=0,r=e.length;o<r;o++)if(n=e[o],!(0<=g.call(t,n)))return!1;return!0},n=function(e,t){var n,o,r;if(e.length!==t.length)return!1;for(n=o=0,r=e.length;0<=r?o<r:o>r;n=0<=r?++o:--o)if(e[n]!==t[n])return!1;return!0},c=function(e,t){var n,o,r;for(o=0,r=e.length;o<r;o++)if(n=e[o],0>g.call(t,n))return!1;return!0},_=Array.prototype.indexOf||function(e,t){var n,o,r;for(n=o=0,r=e.length;0<=r?o<=r:o>=r;n=0<=r?++o:--o)if(e[n]===t)return n;return-1},u=function(e,t){var n,o,r,i;for(r=o=0,i=e.length;r<i;r++){if(n=e[r],!((n=_.call(t,n))>=o))return!1;o=n}return!0},p=function(){if(e.debug)return console.log.apply(console,arguments)},l=function(e){var t,n;for(n in t=!1,f)if(e===f[n]){t=!0;break}if(!t)for(n in a)if(e===a[n]){t=!0;break}return t},k=function(e){var t,n,o,r,s,c,u;for(s=!0,e.keys.length||p("You're trying to bind a combo with no keys:",e),n=c=0,u=e.keys.length;0<=u?c<u:c>u;n=0<=u?++c:--c)o=e.keys[n],(t=h[o])&&(o=e.keys[n]=t),"meta"===o&&e.keys.splice(n,1,y),"cmd"===o&&p('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(t=0,c=(u=e.keys).length;t<c;t++)o=u[t],l(o)||(p('Do not recognize the key "'+o+'"'),s=!1);if(0<=g.call(e.keys,"meta")||0<=g.call(e.keys,"cmd")){for(t=e.keys.slice(),c=0,u=m.length;c<u;c++)o=m[c],-1<(n=_.call(t,o))&&t.splice(n,1);1<t.length&&(p("META and CMD key combos cannot have more than 1 non-modifier keys",e,t),s=!1)}for(r in e)"undefined"===i[r]&&p("The property "+r+" is not a valid combo property. Your combo has still been registered.");return s},r=function(e,t){var n;return!!t.shiftKey&&(null!=(n=a[e])&&n)},d={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},h={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},a={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},f={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},e._keycode_dictionary=f,e._is_array_in_array_sorted=u,-1!==navigator.userAgent.indexOf("Mac OS X")&&(y="cmd"),-1!==navigator.userAgent.indexOf("Opera")&&(f[17]="cmd"),"function"==typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof exports&&null!==exports?exports.keypress=e:window.keypress=e}).call(this);